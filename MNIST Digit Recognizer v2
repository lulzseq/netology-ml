{
 "cells": [
  {
   "cell_type": "markdown",
   "execution_count": null,
   "metadata": {},
   "source": [
    "# Simple MNIST classification without neural networks"
   ]
  },
  {
   "cell_type": "markdown",
   "execution_count": null,
   "metadata": {},
   "source": [
    "Let's try won't apply neural network, but apply the following simple methods to the MNIST classification problem:\n",
    "\n",
    "1) Stratified K-Folds cross-validator    \n",
    "2) Principal component analysis (PCA)    \n",
    "3) K-nearest neighbours (kNN)"
   ]
  },
  {
   "cell_type": "markdown",
   "execution_count": null,
   "metadata": {},
   "source": [
    "### Load the modules"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 1,
   "metadata": {
    "_cell_guid": "79c7e3d0-c299-4dcb-8224-4455121ee9b0",
    "_uuid": "d629ff2d2480ee46fbb7e2d37f6b5fab8052498a"
   },
   "outputs": [],
   "source": [
    "from sklearn.neighbors import KNeighborsClassifier\n",
    "from sklearn.model_selection import RandomizedSearchCV, train_test_split, StratifiedKFold\n",
    "from sklearn.metrics import classification_report\n",
    "from sklearn.decomposition import PCA\n",
    "import numpy as np\n",
    "import pandas as pd\n",
    "import matplotlib.pyplot as plt\n",
    "import time\n",
    "import warnings\n",
    "warnings.filterwarnings('ignore')"
   ]
  },
  {
   "cell_type": "markdown",
   "execution_count": null,
   "metadata": {},
   "source": [
    "### Read and preparing data"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 2,
   "metadata": {},
   "outputs": [],
   "source": [
    "train = np.loadtxt('/kaggle/input/digit-recognizer/train.csv', delimiter=',', skiprows=1)\n",
    "test = np.loadtxt('/kaggle/input/digit-recognizer/test.csv', delimiter=',', skiprows=1)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 3,
   "metadata": {},
   "outputs": [],
   "source": [
    "train_label = train[:, 0]\n",
    "train_data = np.delete(train, train[:, 0], axis=1)\n",
    "\n",
    "train_img = np.resize(train[:, 1:], (train.shape[0], 28, 28))\n",
    "test_img = np.resize(test, (test.shape[0], 28, 28))\n",
    "\n",
    "origin_train_img = train_img.reshape(-1, 28 * 28).astype(np.float32)\n",
    "origin_test_img = test_img.reshape(-1, 28 * 28).astype(np.float32)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 4,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "image/png": "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N2cxnKpcdtllLvvVr37lspjPw2mui2n8S+joEML7KewHSAN9RCzoImJBFxET+oia4mtpAAAAAAqhrZObIOkxM3vGzM5L2sDMzjOzhWa2sI3HAsppsY90ERnitRGxoIuICe/TqLm2fi3t8BDC22a2p6Q5ZvZSCGHejhuEEG6RdIsU9/cnUQgt9pEuIkO8NiIWdBEx4X0aNdemBQUa7chsgqT1IYQbWtiGotbQj370I5eNHz/eZZ06dXLZXXfd5bKkC0h99NFHVY6uMm05UXFH5foYSxd79OjhsqRFG0444YQshpOad99912UjR4502csvv+yyNWvW1GRMrZVVF0vbRNHHLLCgQHXS6GOsXdxnn31clrSgyd577+2y1atX12RMaejbt6/L7r33XpcNHTo0i+Gkpr29T3ft2tVl8+fPd9nAgQOzGE5NXXTRRS6bNGlSDiOpTHNdrPpraWbW1cy6b/9d0nBJi6vdH9AW9BGxoIuIBV1ETOgjstKWr6X1lnSvmW3fz+0hhEdTGRXQevQRsaCLiAVdREzoIzJR9eQmhPCapEEpjgWoGn1ELOgiYkEXERP6iKywFDQAAACAQkhtQYGKDhbJyWFFMGrUKJfdcccdLuvcubPLFi1a5LKvfOUrLlu3bl2Vo6teWicqlhNLF0eMGOGyRx55JIeR5OPCCy902eTJk3MYiZdVF6V4+piFahcUGDNmjMtivvp32trba+PatWtd9oc//MFl5557bhbDqUrSggLLli1z2dFHH+2yP//5zzUZUxraWxf3228/l/3rX//KYSS198orr7hs4sSJLpsyZYrLtm3bVpMxtST1BQUAAAAAICZMbgAAAAAUApMbAAAAAIXA5AYAAABAIbTlOjfISL9+/Vx25ZVXuixp8YBVq1a5bPz48S7LY/GA9uaII45w2eWXX57DSKSLL7640e23337bbfO9733PZYceemiq47j++utd9sEHH7hs1qxZqR4X9WfkyJEua08LCrQ399xzj8uGDBnisqT3vc2bN9dkTLWy0078d+ZY9O7d22UPPfRQqsfYsmWLy5IWy0ha6Kmpvfbay2Wf+tSnqhuYpAMPPNBlv/nNb1w2b948l7388stVHzdt/D8KAAAAQCEwuQEAAABQCExuAAAAABQCkxsAAAAAhcCCApEZOnSoy2699VaXHXzwwRXt76KLLnLZgw8+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\n",
      "text/plain": [
       "<Figure size 1440x720 with 5 Axes>"
      ]
     },
     "metadata": {
      "needs_background": "light"
     },
     "output_type": "display_data"
    }
   ],
   "source": [
    "fig = plt.figure(figsize=(20, 10))\n",
    "for i, img in enumerate(train_img[0:5], 1):\n",
    "    subplot = fig.add_subplot(1, 7, i)\n",
    "    plt.imshow(img, cmap='gray');\n",
    "    subplot.set_title('%s' % train_label[i - 1]);"
   ]
  },
  {
   "cell_type": "markdown",
   "execution_count": null,
   "metadata": {},
   "source": [
    "### Let's apply PCA and find acceptable n_components"
   ]
  },
  {
   "cell_type": "markdown",
   "execution_count": null,
   "metadata": {},
   "source": [
    "Usually a variance of 90% is sufficient."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 5,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "image/png": "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\n",
      "text/plain": [
       "<Figure size 1008x432 with 1 Axes>"
      ]
     },
     "metadata": {
      "needs_background": "light"
     },
     "output_type": "display_data"
    }
   ],
   "source": [
    "pca = PCA().fit(origin_train_img)\n",
    "\n",
    "plt.figure(figsize=(14,6))\n",
    "plt.plot(np.cumsum(pca.explained_variance_ratio_), color='b', lw=3)\n",
    "plt.axhline(0.9, linestyle='--', c='r', lw=1)\n",
    "plt.axvline(85, linestyle='--', c='r', lw=1)\n",
    "plt.title('90% dispersion with n_components=85', fontsize=14)\n",
    "plt.grid(True)\n",
    "plt.show();"
   ]
  },
  {
   "cell_type": "markdown",
   "execution_count": null,
   "metadata": {},
   "source": [
    "Let's reduce out data with PCA and use n_components = 85."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 6,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "((42000, 784), (42000, 85), (28000, 784), (28000, 85))"
      ]
     },
     "execution_count": 6,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "pca = PCA(n_components=85)\n",
    "train_reduced = pca.fit_transform(origin_train_img)\n",
    "test_reduced = pca.transform(origin_test_img)\n",
    "origin_train_img.shape, train_reduced.shape, origin_test_img.shape, test_reduced.shape"
   ]
  },
  {
   "cell_type": "markdown",
   "execution_count": null,
   "metadata": {},
   "source": [
    "We reduced data almost in 10 times! Now split it on train and test datasets.\n",
    "\n",
    "I used set test_size from 0.05 to 0.3 and 0.1 gives best result."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 7,
   "metadata": {},
   "outputs": [],
   "source": [
    "X_train, X_test, y_train, y_test = train_test_split(train_reduced, train_label, test_size=0.1, random_state=42)"
   ]
  },
  {
   "cell_type": "markdown",
   "execution_count": null,
   "metadata": {},
   "source": [
    "### Modeling"
   ]
  },
  {
   "cell_type": "markdown",
   "execution_count": null,
   "metadata": {},
   "source": [
    "I used cross validation. Here I also tried StratifiedKFold and just KFols with diffirent count of n_splits (from 10 to 500) and best result give StratifiedKFold with n_splits = 10."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 8,
   "metadata": {},
   "outputs": [],
   "source": [
    "cv = StratifiedKFold(n_splits=10, shuffle=False, random_state=42)"
   ]
  },
  {
   "cell_type": "markdown",
   "execution_count": null,
   "metadata": {},
   "source": [
    "Here I use method for find best parameters for my model.\n",
    "\n",
    "By the way, I tried diffirent models and best result give exactly kNN."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 9,
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Fitting 10 folds for each of 10 candidates, totalling 100 fits\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "[Parallel(n_jobs=-1)]: Using backend LokyBackend with 4 concurrent workers.\n",
      "[Parallel(n_jobs=-1)]: Done  42 tasks      | elapsed: 10.3min\n",
      "[Parallel(n_jobs=-1)]: Done 100 out of 100 | elapsed: 23.8min finished\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "CPU times: user 1.1 s, sys: 298 ms, total: 1.4 s\n",
      "Wall time: 23min 50s\n"
     ]
    },
    {
     "data": {
      "text/plain": [
       "(0.9637037037037036,\n",
       " {'weights': 'distance',\n",
       "  'p': 1,\n",
       "  'n_neighbors': 11,\n",
       "  'metric': 'manhattan',\n",
       "  'leaf_size': 43,\n",
       "  'algorithm': 'ball_tree'})"
      ]
     },
     "execution_count": 9,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "%%time\n",
    "\n",
    "param_distributions = {'n_neighbors': np.arange(1,100),\n",
    "                       'weights': ['distance'],\n",
    "                       'leaf_size': np.arange(1,100),\n",
    "                       'p': [1,2],\n",
    "                       'metric': ['euclidean', 'manhattan'],\n",
    "                       'algorithm': ['ball_tree']}\n",
    "\n",
    "rs = RandomizedSearchCV(estimator = KNeighborsClassifier(),\n",
    "                        param_distributions = param_distributions,\n",
    "                        scoring='accuracy',\n",
    "                        refit='accuracy',\n",
    "                        error_score='raise',\n",
    "                        cv = cv,\n",
    "                        verbose=True,\n",
    "                        random_state=42,\n",
    "                        n_jobs=-1)\n",
    "\n",
    "rs_fit = rs.fit(X_train, y_train)\n",
    "rs_fit.best_score_, rs_fit.best_params_"
   ]
  },
  {
   "cell_type": "markdown",
   "execution_count": null,
   "metadata": {},
   "source": [
    "Let's watch to classification report for every element."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 10,
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "              precision    recall  f1-score   support\n",
      "\n",
      "         0.0       0.97      0.99      0.98       408\n",
      "         1.0       0.94      1.00      0.97       471\n",
      "         2.0       0.99      0.94      0.96       420\n",
      "         3.0       0.97      0.96      0.96       506\n",
      "         4.0       0.98      0.95      0.97       397\n",
      "         5.0       0.94      0.96      0.95       339\n",
      "         6.0       0.97      0.98      0.98       402\n",
      "         7.0       0.95      0.95      0.95       438\n",
      "         8.0       0.98      0.92      0.95       403\n",
      "         9.0       0.94      0.96      0.95       416\n",
      "\n",
      "    accuracy                           0.96      4200\n",
      "   macro avg       0.96      0.96      0.96      4200\n",
      "weighted avg       0.96      0.96      0.96      4200\n",
      "\n",
      "CPU times: user 44.1 s, sys: 22.7 ms, total: 44.2 s\n",
      "Wall time: 11.5 s\n"
     ]
    }
   ],
   "source": [
    "%%time\n",
    "\n",
    "knn = KNeighborsClassifier(n_neighbors=rs_fit.best_params_['n_neighbors'],\n",
    "                           algorithm=rs_fit.best_params_['algorithm'],\n",
    "                           metric=rs_fit.best_params_['metric'],\n",
    "                           weights=rs_fit.best_params_['weights'],\n",
    "                           p=rs_fit.best_params_['p'],\n",
    "                           leaf_size=rs_fit.best_params_['leaf_size'],\n",
    "                           n_jobs=-1)\n",
    "knn.fit(X_train, y_train)\n",
    "y_predict = knn.predict(X_test)\n",
    "\n",
    "print(classification_report(y_test, y_predict))"
   ]
  },
  {
   "cell_type": "markdown",
   "execution_count": null,
   "metadata": {},
   "source": [
    "Ok, not bad. Let's fit it and compare predict with test data."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 11,
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "CPU times: user 29min 52s, sys: 1.18 s, total: 29min 53s\n",
      "Wall time: 7min 44s\n"
     ]
    }
   ],
   "source": [
    "%%time\n",
    "\n",
    "knn.fit(origin_train_img, train_label)\n",
    "prediction = knn.predict(origin_test_img)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 12,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "image/png": "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unXVHkK1RNfHfffd18uuueYaL/v0008rfo7Q4gEHHXRQxcerhtACFc8995yXhRbLOPLII+ttP/bYY94+VfgzEV0X0zBq1CgvGzHC/wj9kCFDvCztxQMGDx7sZXfeeaeXffe73/WyqVOnpjKmKkmsiz179vSyN998s9LDJWrPPff0stD/29D58r333ktlTI1p06ZN5s8ZiRZxbiz2/vvvl5V17NjRy4oXONlrr728fZYsWeJlF1xwgZeZ+dfdP/LII14W8+IBTVHOUtAzJP1F0hfMbJmZnaW6cg4xs8WShhS2gdTRR8SCLiIWdBExoY+otpLv3DjnTm3gP/n/PAakjD4iFnQRsaCLiAl9RLVVes0NAAAAAESFyQ0AAACAXEh9KWhk54tf/GK1hwA0ybJly7zshhtu8LLQggITJ06stz1t2jRvnxa8yEaqDj30UC8LXdg6e/bsxJ5z11139bIJEyZ42ZlnnullTzzxhJeF+oKwWBYPCLn99tu9LLSoxGc/+9kshlNSaLGDkDfeeCPlkSAm5513npdNmjSpomOFFg8InQPHjx9f0fFrAe/cAAAAAMgFJjcAAAAAcoHJDQAAAIBcYHIDAAAAIBdYUCBHLrzwwmoPAQm4/vrrveyFF17wsvXr12cxnMz95S9/8bIHHnjAy0aNGpXFcFCm1q1bl7XfLrvs4mV9+vSptz1y5Ehvn0MOOcTLPvroIy/bYQf/3+y+853veNmWLVsaHSfiE7qLe2ixg1B/Vq9encaQGnXAAQd42cknn1zWY/fZZ5+kh4OIPfzww15W/DMudA4s16ZNm8rK8oJ3bgAAAADkApMbAAAAALnA5AYAAABALnDNTUoGDBjgZV/4whfqbW/dutXb56677irr+H379vWyzp07lze4gOeee87LNm/eXPHxWrrf/OY3Ze138803e9lVV13lZS3pZpShG3suWrSo5ONmzpzpZcV/5pCMZ555xssuuugiL3vrrbe8rG3btl7WqVOnetuPPvqot8/kyZO97P777/ey0LWH7733npeh9oRudPjtb3/by6ZPn57FcOo5+OCDvexXv/qVl7Vr187LXnvtNS/70pe+lMzAUBNeeeUVLzv22GPrbY8ZM8bbJ3SNbps2bbxs6NChXnb++ed72Y033tjoOGsF79wAAAAAyAUmNwAAAABygckNAAAAgFxgcgMAAAAgF8w51/gOZtMkfUXSKudc30L2A0nflvS/hd0udc79vuSTmTX+ZCkIXbwXuhHYiBEjvGzVqlVeNn78+LKed//99/eybt261dv+9NNPvX1CF+qG9OjRw8v23Xffsh67YMECLxs2bJiXLV++vKzjJck5Z43996T6mHYXQ/9vP/jgAy+77LLLvGzKlCmpjKlWhG7y+KMf/cjLxo0bV/JYrVpVvmZKVl0sPC7zc2PSQueQL3/5y14Wurj/2WefrbcdupHrLbfc4mXHHHOMl4Uu7A79eaw1jfWxpXTx1Vdf9bLQ/9tevXqlOo7QzTnvvfdeLwst/BO68Wz//v29bN68eRWOLn15+TmdB6Hz7u9/739bQ3/XX7JkiZcdfvjhXhbzgkYNdbGcd27ukuQvsyBd75zrV/hV8oQJJOQu0UfE4S7RRcThLtFFxOMu0UdUUcnJjXPuGUlrMhgLUBJ9RCzoImJBFxET+ohqa841N+eb2Xwzm2ZmuzW0k5mNNbO5Zja3Gc8FlFKyj3QRGeHciFjQRcSEn9PIRKWTmymS9pXUT9IKSdc1tKNzbqpz7nDnnP9BPiAZZfWRLiIDnBsRC7qImPBzGpmp6Gpb59zKbV+b2W2SHklsRE3Qu3fvetsnnniit8/RRx/tZaHFA6phhx38ueWgQYNSf97QIgunnnqql91www1e9vHHH6cypuaIpY/bC13kOmvWLC9r6YsHnHLKKV525JFHetk555zjZcXf49Bd7bMWYxez8oc//KGsrByjR4/2stCd6E844QQvy8PiAUmo9S6GLtovXpRHSv7neefOnettT5482dvnjDPO8LLQz9V33nnHy0466SQvC92dPm9qvY+xCp1jf/GLX3jZ+eef72WhRahOP/30so4Xu4reuTGzrtttfk1S/v9kIlr0EbGgi4gFXURM6COyVPKdGzObIWmQpC5mtkzSZEmDzKyfJCfpTUn+P6sCKaCPiAVdRCzoImJCH1FtJSc3zjn/80rSHSmMBSiJPiIWdBGxoIuICX1EtTVntTQAAAAAiEblt++OwFe+8pV621dffXWixw/dSfj111/3stCFhJ/73OcSHUuSevbs6WXXXHONl4XurjxhwoR622vXrk1sXHlXvACGJA0cONDLnn766SyGk6rQQgGh13/FFVd4WaUXhF9yySUVPQ7VV3zx+G233ebtc+edd3rZ448/ntqYUBtCi/A88cQTXta+fXsv++lPf+plQ4fWv/dk9+7dvX1CC+vceuutXnbjjTd62YIFC7wMLUvxohWSdNppp3nZgQceWG/7wgsv9PbZsGGDl/3whz/0stCCAiHOubL2ix3v3AAAAADIBSY3AAAAAHKByQ0AAACAXGByAwAAACAXLMuLh8ws0ScrvvC4Oa/lqaee8rJ77rnHy+64w1/NMHSB/n333edlhx12WEVjW79+vZeFFgAIGTJkiJeFLmIv18yZM+ttjxw5suJjhTjnLNEDNiDpLhbbsmWLl4UulF+4cKGXnXOOv/z/nDlzkhlYA6677jov69Gjh5eVe7H/kUce6WWhC3N32MH/95Vyn+P666+vt33VVVd5+6xbt66sY4Vk1UUp/T7GpHXr1l724osvlnzc0Ucf7WWhi2nzKi/nxuZ49dVXvSy0eE9oQYGDDjrIy7p161bRc1588cVeNmvWrJLHygu6GNahQwcvC13If9FFF3nZzjvv7GXFi/AsW7asrHF06dLFy1auXFnWY88++2wvCy3mEouGusg7NwAAAABygckNAAAAgFxgcgMAAAAgF5jcAAAAAMiFml5QoHjsld7ZXJLWrl3rZR988EHFxwvdgTZ0h+RioYu+Tj/9dC/74x//WNY4dtttNy+bNm2alx1xxBFettdee5U8/o477ljWOMqVlwsVy11QIGT58uVeFlpUwsz/VlX653mfffbxss985jNe1pw/YyHlLihw8803e9mVV15Zb7s5iweEsKBAOsaMGeNlxXeKP/7447195s+fn9qYakFezo3NEVrkZ/To0WU9ttzz5YMPPlhv+9xzz/X2Wb16dVnPmVd0Udp///297Pbbb/eyAQMGeNknn3ziZUcddZSXzZs3r9526O9zoYWqfvKTn3hZv379vCz0981jjz3Wy5YsWeJlsWBBAQAAAAC5xuQGAAAAQC4wuQEAAACQCyUnN2bWw8yeNLOFZrbAzCYU8k5m9piZLS787n8YEEgQXURM6CNiQRcRC7qIGJRcUMDMukrq6pz7m5l1kPSipBGSTpe0xjn3YzObJGk359z3Shwr0YvDii+MD12oGpPii8NCF58tWrTIy5588snUxrTNcccd52W/+93vvOy+++6rt33WWWclOo7GLlSMuYvF+vTp42Uvv/xyos9R7sX4lQotFrF169aKj7d06VIv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\n",
      "text/plain": [
       "<Figure size 1440x720 with 5 Axes>"
      ]
     },
     "metadata": {
      "needs_background": "light"
     },
     "output_type": "display_data"
    }
   ],
   "source": [
    "fig = plt.figure(figsize=(20, 10))\n",
    "for i, img in enumerate(test_img[0:5], 1):\n",
    "    subplot = fig.add_subplot(1, 7, i)\n",
    "    plt.imshow(img, cmap='gray');\n",
    "    subplot.set_title('%s' % prediction[i - 1]);"
   ]
  },
  {
   "cell_type": "markdown",
   "execution_count": null,
   "metadata": {},
   "source": [
    "Not bad. Save result and try to leave submit."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 13,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>ImageId</th>\n",
       "      <th>Label</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>0</th>\n",
       "      <td>1</td>\n",
       "      <td>2</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1</th>\n",
       "      <td>2</td>\n",
       "      <td>0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2</th>\n",
       "      <td>3</td>\n",
       "      <td>9</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>3</th>\n",
       "      <td>4</td>\n",
       "      <td>9</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4</th>\n",
       "      <td>5</td>\n",
       "      <td>3</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>5</th>\n",
       "      <td>6</td>\n",
       "      <td>7</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>6</th>\n",
       "      <td>7</td>\n",
       "      <td>0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>7</th>\n",
       "      <td>8</td>\n",
       "      <td>3</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>8</th>\n",
       "      <td>9</td>\n",
       "      <td>0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>9</th>\n",
       "      <td>10</td>\n",
       "      <td>3</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "   ImageId  Label\n",
       "0        1      2\n",
       "1        2      0\n",
       "2        3      9\n",
       "3        4      9\n",
       "4        5      3\n",
       "5        6      7\n",
       "6        7      0\n",
       "7        8      3\n",
       "8        9      0\n",
       "9       10      3"
      ]
     },
     "execution_count": 13,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "# save result\n",
    "\n",
    "submission = pd.read_csv('/kaggle/input/digit-recognizer/sample_submission.csv')\n",
    "submission['Label'] = prediction.astype(int)\n",
    "submission.head(10)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 14,
   "metadata": {
    "_kg_hide-output": true
   },
   "outputs": [],
   "source": [
    "submission.to_csv('submission.csv', index=False, header=True)"
   ]
  },
  {
   "cell_type": "markdown",
   "execution_count": null,
   "metadata": {},
   "source": [
    "The best result was 0.96235."
   ]
  }
 ],
 "metadata": {
  "kernelspec": {
   "display_name": "Python 3",
   "language": "python",
   "name": "python3"
  },
  "language_info": {
   "codemirror_mode": {
    "name": "ipython",
    "version": 3
   },
   "file_extension": ".py",
   "mimetype": "text/x-python",
   "name": "python",
   "nbconvert_exporter": "python",
   "pygments_lexer": "ipython3",
   "version": "3.7.6"
  }
 },
 "nbformat": 4,
 "nbformat_minor": 4
}
